NAME = speaker

ARMGNU ?= arm-none-eabi

XCPU = -mcpu=cortex-m0plus

AOPS = --warn --fatal-warnings $(XCPU)
COPS = -Wall -O2 -nostartfiles -ffreestanding $(XCPU)
LOPS = -nostdlib

.PHONY: all clean

all : $(NAME).uf2

clean:
		rm -f *.bin
		rm -r *.o
		rm -f *.elf
		rm -f *.list
		rm -f *.uf2
		rm -f makeuf2

# ------------------------------------------------------

makeuf2 : makeuf2.c crcpico.h
		gcc -O2 makeuf2.c -o makeuf2

$(NAME).uf2 : $(NAME).bin makeuf2
		./makeuf2 $(NAME).bin $(NAME).uf2

start.o : start.s
		$(ARMGNU)-as $(AOPS) start.s -o start.o

$(NAME).o : $(NAME).c
		$(ARMGNU)-gcc $(COPS) -mthumb -c $(NAME).c -o $(NAME).o

$(NAME).bin : rp2040.ld start.o $(NAME).o
		$(ARMGNU)-ld $(LOPS) -T rp2040.ld start.o $(NAME).o -o $(NAME).elf
		$(ARMGNU)-objdump -D $(NAME).elf > $(NAME).list
		$(ARMGNU)-objcopy -O binary $(NAME).elf $(NAME).bin
